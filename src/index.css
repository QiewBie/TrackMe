@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  min-height: 100%;
  width: 100%;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  @apply bg-bg-main;
}

body {
  min-height: 100%;
  width: 100%;
  -webkit-font-smoothing: antialiased;
}

#root {
  min-height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
}

@layer base {
  :root {
    /* 
      Theme System: HSL Channels 
      Format: H S% L% (No 'hsl()', allows alpha injection)
      
      NOTE: The values below are the "Default Blue" fallback (Rescue Theme).
      The active theme is injected by ThemeContext.tsx from ThemeRegistry.ts.
      To add new themes or modify colors, edit src/config/ThemeRegistry.ts.
    */

    /* RESCUE THEME (Minimal Fallback) */
    --bg-main: 210 40% 98%;
    --bg-surface: 0 0% 100%;

    /* Palette (Category Colors) */
    --palette-blue: 217 91% 60%;
    /* #3b82f6 */
    --palette-red: 0 84% 60%;
    /* #ef4444 */
    --palette-green: 142 71% 45%;
    /* #22c55e */
    --palette-amber: 38 92% 50%;
    /* #f59e0b */
    --palette-purple: 271 91% 65%;
    /* #a855f7 */
    --palette-pink: 330 81% 60%;
    /* #ec4899 */
    --palette-cyan: 189 94% 43%;
    /* #06b6d4 */
    --palette-indigo: 239 84% 67%;
    /* #6366f1 */
    --palette-slate: 215 16% 47%;
    /* #64748b */
    --palette-emerald: 158 84% 39%;
    /* #10b981 */
    --palette-slate-light: 215 20% 65%;
    /* #94a3b8 */

    /* Subtlety, Text, Borders, Brand, Gradients removed (Managed by ThemeRegistry) */
    --text-on-brand: 0 0% 100%;

    /* Status Colors */
    --status-success: 158 84% 39%;
    /* #10b981 */
    --status-error: 0 84% 60%;
    /* #ef4444 */
    --status-warning: 38 92% 50%;
    /* #f59e0b */
    --status-info: 217 91% 60%;
    /* #3b82f6 (blue-500) */

    /* UI States */
    --ui-disabled: 215 20% 65%;
    /* #94a3b8 */

    /* Shadows */
    --shadow-color: 222 47% 11%;
    /* rgb(15 23 42) */
    --shadow-tooltip: 0 4px 6px -1px rgba(0, 0, 0, 0.1);

    /* Gradients removed (Managed by ThemeRegistry) */

    /* Tags (Specific semantic slots for categories/labels) */
    --tag-blue: 217 91% 60%;
    --tag-red: 0 84% 60%;
    --tag-green: 142 71% 45%;
    --tag-amber: 38 92% 50%;
    --tag-purple: 271 91% 65%;
    --tag-pink: 330 81% 60%;
    --tag-cyan: 189 94% 43%;
    --tag-indigo: 239 84% 67%;
    --tag-slate: 215 16% 47%;
    --tag-emerald: 158 84% 39%;
  }

  .dark {
    /* Dark Mode Defaults removed (Managed by ThemeRegistry) */

    /* UI States */
    --ui-disabled: 215 16% 47%;
    /* #475569 (slate-600) */

    /* Shadows */
    --shadow-color: 222 47% 11%;
    /* rgb(15 23 42) */
    --shadow-tooltip: 0 4px 6px -1px rgba(0, 0, 0, 0.4);

    /* Gradients removed */
  }
}

@layer utilities {
  .shadow-card {
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  }

  .dark .shadow-card {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -2px rgba(0, 0, 0, 0.2);
  }

  .bg-overlay {
    @apply bg-black/60;
  }

  .pb-safe {
    padding-bottom: env(safe-area-inset-bottom);
  }

  .pt-safe {
    padding-top: env(safe-area-inset-top);
  }

  .mb-safe {
    margin-bottom: env(safe-area-inset-bottom);
  }
}

body {
  @apply bg-bg-main text-text-primary transition-colors duration-500 ease-in-out;

  /* 
     Mobile Navigation Layout System 
     -------------------------------
     Centralized configuration for the "True Native" PWA layout.
     These variables control the "Floating Pill" and the content occlusion logic.
  */
  --nav-height: 3.5rem;
  /* 56px - Standard Mobile Nav Height */
  --nav-offset: 0.5rem;
  /* 8px - Visual float from safe area */
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);

  --layout-mobile-padding-bottom: calc(var(--safe-area-bottom) + var(--nav-height) + var(--nav-offset) + 1rem);
}

/* Enforce font inheritance for form elements */
input,
button,
textarea,
select {
  font-family: inherit;
}

/* 5. Custom Scrollbar */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.horizontal-scrollbar::-webkit-scrollbar {
  height: 10px;
}

::-webkit-scrollbar-track {
  @apply bg-transparent;
}

::-webkit-scrollbar-thumb {
  @apply bg-border dark:bg-border-subtle rounded-full hover:bg-ui-disabled transition-colors;
}

/* 6. Accessibility & Focus Management */
@layer base {

  /* Remove default ugly outlines for mouse users, but KEEP for keyboard */
  :focus:not(:focus-visible) {
    outline: none;
  }

  /* Accessible Focus Ring */
  :focus-visible {
    @apply outline-none ring-2 ring-brand-primary ring-offset-2 ring-offset-bg-surface;
  }
}

/* 6. ProseMirror Editor Styles (Encapsulated) */
.rich-text-editor .ProseMirror {
  outline: none;
}

.rich-text-editor .ProseMirror h1 {
  font-size: 1.8em;
  font-weight: 800;
  line-height: 1.2;
  margin-bottom: 0.5em;
  margin-top: 0.2em;
}

.rich-text-editor .ProseMirror h2 {
  font-size: 1.4em;
  font-weight: 700;
  line-height: 1.3;
  margin-bottom: 0.5em;
  margin-top: 0.5em;
}

.rich-text-editor .ProseMirror ul {
  list-style-type: disc;
  padding-left: 1.5em;
  margin-bottom: 1em;
}

.rich-text-editor .ProseMirror ol {
  list-style-type: decimal;
  padding-left: 1.5em;
  margin-bottom: 1em;
}

.rich-text-editor .ProseMirror blockquote {
  border-left: 3px solid var(--border-color);
  padding-left: 1rem;
  margin-left: 0;
  font-style: italic;
  color: var(--text-secondary);
}

/* 8. Recharts Focus Outline Removal */
.recharts-wrapper,
.recharts-surface,
.recharts-wrapper *:focus,
.recharts-surface *:focus {
  outline: none !important;
}

/* Specific overrides for interactive SVGs/Graphics that don't need rings */
div[role="img"]:focus:not(:focus-visible) {
  outline: none;
  box-shadow: none;
}

/* 8. Global Range Slider Styles */
@layer components {

  /* Webkit (Chrome/Safari/Edge) */
  .slider-thumb-webkit::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    height: 18px;
    width: 18px;
    border-radius: 50%;
    background-color: hsl(var(--brand-primary));
    border: 2px solid hsl(var(--bg-surface));
    box-shadow: 0 0 0 1px hsl(var(--border-subtle)), 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-top: -6px;
    /* (18px thumb - 6px track) / 2 = 6px. Negative to pull up. */
    cursor: pointer;
    transition: transform 0.1s;
  }

  .slider-thumb-webkit::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 0 0 2px hsl(var(--brand-primary)), 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  /* Firefox */
  .slider-thumb-moz::-moz-range-thumb {
    height: 18px;
    width: 18px;
    border-radius: 50%;
    background-color: hsl(var(--brand-primary));
    border: 2px solid hsl(var(--bg-surface));
    box-shadow: 0 0 0 1px hsl(var(--border-subtle)), 0 2px 4px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: transform 0.1s;
  }

  .slider-thumb-moz::-moz-range-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 0 0 2px hsl(var(--brand-primary)), 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .slider-track-moz::-moz-range-track {
    width: 100%;
    height: 6px;
    border-radius: 9999px;
    background-color: transparent;
    cursor: pointer;
  }
}

@layer utilities {
  .pb-safe {
    padding-bottom: env(safe-area-inset-bottom, 0px);
  }

  .pt-safe {
    padding-top: env(safe-area-inset-top, 0px);
  }

  .min-h-safe {
    min-height: calc(100dvh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
  }
}